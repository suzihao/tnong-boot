<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.tnong.boot.system.dept.mapper.SysDeptMapper">

    <select id="selectById" resultType="com.tnong.boot.system.dept.domain.entity.SysDept">
        SELECT * FROM sys_dept WHERE id = #{id} AND tenant_id = #{tenantId} AND delete_flag = 0
    </select>

    <select id="selectList" resultType="com.tnong.boot.system.dept.domain.entity.SysDept">
        SELECT * FROM sys_dept WHERE tenant_id = #{tenantId} AND delete_flag = 0 ORDER BY sort ASC, created_time ASC
    </select>

    <select id="selectByParentId" resultType="com.tnong.boot.system.dept.domain.entity.SysDept">
        SELECT * FROM sys_dept WHERE parent_id = #{parentId} AND tenant_id = #{tenantId} AND delete_flag = 0 ORDER BY sort ASC
    </select>

    <insert id="insert" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO sys_dept (tenant_id, parent_id, name, code, sort, status, leader_user_id, phone, email, remark, delete_flag, created_time, created_user, updated_time, updated_user, version)
        VALUES (#{tenantId}, #{parentId}, #{name}, #{code}, #{sort}, #{status}, #{leaderUserId}, #{phone}, #{email}, #{remark}, 0, NOW(), #{createdUser}, NOW(), #{updatedUser}, 0)
    </insert>

    <update id="updateByIdWithVersion">
        UPDATE sys_dept
        <set>
            <if test="name != null">name = #{name},</if>
            <if test="parentId != null">parent_id = #{parentId},</if>
            <if test="sort != null">sort = #{sort},</if>
            <if test="status != null">status = #{status},</if>
            <if test="leaderUserId != null">leader_user_id = #{leaderUserId},</if>
            <if test="phone != null">phone = #{phone},</if>
            <if test="email != null">email = #{email},</if>
            <if test="remark != null">remark = #{remark},</if>
            updated_time = NOW(), updated_user = #{updatedUser}, version = version + 1
        </set>
        WHERE id = #{id} AND tenant_id = #{tenantId} AND version = #{version} AND delete_flag = 0
    </update>

    <update id="deleteById">
        UPDATE sys_dept SET delete_flag = 1, updated_time = NOW(), updated_user = #{updatedUser}, version = version + 1
        WHERE id = #{id} AND tenant_id = #{tenantId} AND version = #{version} AND delete_flag = 0
    </update>

</mapper>
