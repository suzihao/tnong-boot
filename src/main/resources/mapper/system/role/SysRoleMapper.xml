<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.tnong.boot.system.role.mapper.SysRoleMapper">

    <select id="selectById" resultType="com.tnong.boot.system.role.domain.entity.SysRole">
        SELECT * FROM sys_role WHERE id = #{id} AND tenant_id = #{tenantId} AND delete_flag = 0
    </select>

    <select id="selectByCode" resultType="com.tnong.boot.system.role.domain.entity.SysRole">
        SELECT * FROM sys_role WHERE code = #{code} AND tenant_id = #{tenantId} AND delete_flag = 0
    </select>

    <select id="selectList" resultType="com.tnong.boot.system.role.domain.entity.SysRole">
        SELECT * FROM sys_role WHERE tenant_id = #{tenantId} AND delete_flag = 0 ORDER BY sort ASC, created_time DESC
    </select>

    <insert id="insert" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO sys_role (tenant_id, code, name, data_scope, sort, status, is_system, remark, delete_flag, created_time, created_user, updated_time, updated_user, version)
        VALUES (#{tenantId}, #{code}, #{name}, #{dataScope}, #{sort}, #{status}, #{isSystem}, #{remark}, 0, NOW(), #{createdUser}, NOW(), #{updatedUser}, 0)
    </insert>

    <update id="updateByIdWithVersion">
        UPDATE sys_role
        <set>
            <if test="name != null">name = #{name},</if>
            <if test="dataScope != null">data_scope = #{dataScope},</if>
            <if test="sort != null">sort = #{sort},</if>
            <if test="status != null">status = #{status},</if>
            <if test="remark != null">remark = #{remark},</if>
            updated_time = NOW(), updated_user = #{updatedUser}, version = version + 1
        </set>
        WHERE id = #{id} AND tenant_id = #{tenantId} AND version = #{version} AND delete_flag = 0
    </update>

    <update id="deleteById">
        UPDATE sys_role SET delete_flag = 1, updated_time = NOW(), updated_user = #{updatedUser}, version = version + 1
        WHERE id = #{id} AND tenant_id = #{tenantId} AND version = #{version} AND delete_flag = 0
    </update>

</mapper>
