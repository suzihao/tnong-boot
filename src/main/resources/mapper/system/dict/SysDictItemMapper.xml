<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.tnong.boot.system.dict.mapper.SysDictItemMapper">

    <select id="selectById" resultType="com.tnong.boot.system.dict.domain.entity.SysDictItem">
        SELECT * FROM sys_dict_item WHERE id = #{id} AND tenant_id = #{tenantId} AND delete_flag = 0
    </select>

    <select id="selectByTypeCode" resultType="com.tnong.boot.system.dict.domain.entity.SysDictItem">
        SELECT * FROM sys_dict_item WHERE type_code = #{typeCode} AND tenant_id = #{tenantId} AND delete_flag = 0
        ORDER BY sort ASC, created_time ASC
    </select>

    <select id="selectPageList" resultType="com.tnong.boot.system.dict.domain.entity.SysDictItem">
        SELECT * FROM sys_dict_item
        <where>
            AND delete_flag = 0 AND tenant_id = #{tenantId}
            <if test="query.typeCode != null and query.typeCode != ''">AND type_code = #{query.typeCode}</if>
            <if test="query.itemLabel != null and query.itemLabel != ''">AND item_label LIKE CONCAT('%', #{query.itemLabel}, '%')</if>
            <if test="query.status != null">AND status = #{query.status}</if>
        </where>
        ORDER BY sort ASC, created_time DESC
        LIMIT #{query.offset}, #{query.size}
    </select>

    <select id="selectCount" resultType="long">
        SELECT COUNT(*) FROM sys_dict_item
        <where>
            AND delete_flag = 0 AND tenant_id = #{tenantId}
            <if test="query.typeCode != null and query.typeCode != ''">AND type_code = #{query.typeCode}</if>
            <if test="query.itemLabel != null and query.itemLabel != ''">AND item_label LIKE CONCAT('%', #{query.itemLabel}, '%')</if>
            <if test="query.status != null">AND status = #{query.status}</if>
        </where>
    </select>

    <insert id="insert" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO sys_dict_item (tenant_id, type_code, item_value, item_label, css_class, color, sort, status, remark, delete_flag, created_time, created_user, updated_time, updated_user, version)
        VALUES (#{tenantId}, #{typeCode}, #{itemValue}, #{itemLabel}, #{cssClass}, #{color}, #{sort}, #{status}, #{remark}, 0, NOW(), #{createdUser}, NOW(), #{updatedUser}, 0)
    </insert>

    <update id="updateByIdWithVersion">
        UPDATE sys_dict_item
        <set>
            <if test="itemLabel != null">item_label = #{itemLabel},</if>
            <if test="cssClass != null">css_class = #{cssClass},</if>
            <if test="color != null">color = #{color},</if>
            <if test="sort != null">sort = #{sort},</if>
            <if test="status != null">status = #{status},</if>
            <if test="remark != null">remark = #{remark},</if>
            updated_time = NOW(), updated_user = #{updatedUser}, version = version + 1
        </set>
        WHERE id = #{id} AND tenant_id = #{tenantId} AND version = #{version} AND delete_flag = 0
    </update>

    <update id="deleteById">
        UPDATE sys_dict_item SET delete_flag = 1, updated_time = NOW(), updated_user = #{updatedUser}, version = version + 1
        WHERE id = #{id} AND tenant_id = #{tenantId} AND version = #{version} AND delete_flag = 0
    </update>

</mapper>
